# SWOS420 — Docker Compose
#
# Usage:
#   docker compose up --build               # build & run tests
#   docker compose run swos420 python scripts/run_full_season.py --season 25/26 --min-squad-size 1
#   docker compose run swos420 python scripts/train_managers.py --timesteps 50000 --num-teams 8

services:
  swos420:
    build: .
    volumes:
      - .:/app
      - ./data:/app/data
    environment:
      - PYTHONDONTWRITEBYTECODE=1
      - NVIDIA_VISIBLE_DEVICES=all
    deploy:
      resources:
        reservations:
          devices:
            - driver: nvidia
              count: all
              capabilities: [gpu]

  # ── 24/7 SWOS Streaming Service ─────────────────────────────────────
  swos-stream:
    build:
      context: .
      dockerfile: Dockerfile.stream
    volumes:
      - ./streaming:/app/streaming
      - ./config:/app/config
    environment:
      - SWOS_GAME_DIR=/game
      - SWOS420_MODE=420
      - VNC_ENABLED=false
    ports:
      - "5900:5900"  # VNC (when enabled)

  # ── Future services (uncomment when ready) ────────────────────────
  # postgres:
  #   image: postgres:16-alpine
  #   environment:
  #     POSTGRES_DB: swos420
  #     POSTGRES_USER: swos420
  #     POSTGRES_PASSWORD: changeme
  #   ports:
  #     - "5432:5432"
  #   volumes:
  #     - pgdata:/var/lib/postgresql/data

  # redis:
  #   image: redis:7-alpine
  #   ports:
  #     - "6379:6379"

# volumes:
#   pgdata:
